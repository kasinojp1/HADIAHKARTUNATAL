<html lang="id">
firebase.initializeApp(firebaseConfig);
}
const db = firebase.firestore();


// FIXED: menangkap elemen HTML yg hilang
const voucherInput = document.getElementById('voucherInput');
const checkBtn = document.getElementById('checkBtn');
const prizeArea = document.getElementById('prizeArea');


const symbols = ['ðŸŽ…','ðŸŽ','â„ï¸','ðŸ””','ðŸŒŸ'];


function showStatus(msg, error){
const st = document.getElementById('status');
st.textContent = msg;
st.style.color = error ? 'red' : 'white';
}


checkBtn.addEventListener('click', async ()=>{
const code = voucherInput.value.trim();
if(!code){ showStatus('Masukkan kode voucher terlebih dahulu', true); return }


showStatus('Memeriksa voucher...');
const docRef = db.collection('vouchers').doc(code);


try{
await db.runTransaction(async (tx)=>{
const doc = await tx.get(docRef);
if(!doc.exists) throw new Error('Voucher tidak ditemukan.');


const data = doc.data();
if(data.used) throw new Error('Voucher ini sudah dipakai.');


window.__redeemedPrize = data.prize || 'Hadiah Misteri';
tx.update(docRef, { used: true, redeemedAt: firebase.firestore.FieldValue.serverTimestamp() });
});


showStatus('Voucher valid! Mengacak kartu...');
revealCardsAndShowPrize();


}catch(err){
console.error(err);
showStatus(err.message || 'Terjadi kesalahan saat verifikasi', true);
}
});


function randomSymbol(){ return symbols[Math.floor(Math.random()*symbols.length)] }


function revealCardsAndShowPrize(){
const cards = Array.from(document.querySelectorAll('.card'));
cards.forEach(c=>{ c.textContent = 'â“'; c.classList.remove('revealed') });


let i=0;
const interval = setInterval(()=>{
if(i>=cards.length){ clearInterval(interval);
setTimeout(()=>{
prizeArea.style.display='block';
prizeArea.textContent = 'ðŸŽ‰ Selamat! Anda mendapatkan: ' + (window.__redeemedPrize||'Hadiah Misteri');
},400);
return;
}
const sym = randomSymbol();
cards[i].textContent = sym;
cards[i].classList.add('revealed');
i++;
},180);
}
</script>
</body>
</html>
